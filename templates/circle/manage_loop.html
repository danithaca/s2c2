{% extends "circle/manage_base.html" %}
{% load bootstrap %}

{% block more_header %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/3.3.2/css/bootstrap3/bootstrap-switch.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/3.3.2/js/bootstrap-switch.min.js"></script>
<script>
$(document).ready(function() {
  // change to switch
  var bsOptions = defaultBootstrapSwitchOptions();
  var $inputSwitch = $('input.switch');
  $inputSwitch.bootstrapSwitch(bsOptions);
  $inputSwitch.on('switchChange.bootstrapSwitch', function(e, s){
    $('.changes-notice').removeClass('hidden');
  });

  // update field before submit
  $('#circle-loop-form').submit(function() {
    var $data = $('#id_data');
    var data = JSON.parse($data.val());
    data.forEach(function(d) {
      d.approved = $('input[name="' + d.membership_id + '"]').bootstrapSwitch('state');
    });
    $data.val(JSON.stringify(data));
  });
});
</script>
{% endblock %}

{% block manage-block %}
{% if form.membership_data %}
<form id="circle-loop-form" class="form" method="post" autocapitalize="off" {% if form.is_multipart %}enctype="multipart/form-data"{% endif %}>
  {% csrf_token %}
  <ul class="list-group">
    {% for membership in form.membership_data %}
{#      <div class="form-group">#}
{#        <div class="checkbox"><img src="{{ membership.picture }}" class="img-circle img-50"><label>{{ membership.name }} <input type="checkbox" name="{{ membership.membership_id }}" {{ membership.approved|yesno:"checked," }} class="switch"></label></div>#}
{#      </div>#}
      <li class="list-group-item circle-loop" data-slug="{{ membership.name|slugify }}">
        <input type="checkbox" name="{{ membership.membership_id }}" {{ membership.approved|yesno:"checked," }} class="switch">
        <img src="{{ membership.picture }}" class="img-circle img-18"> {{ membership.name }}
      </li>
    {% endfor %}
  </ul>

  {{ form|bootstrap }}
  <p class="text-danger hidden changes-notice"><i class="fa fa-exclamation"></i> Changes are not saved.</p>
  <div class="form-group">
    <button class="btn btn-primary" type="submit">Save Changes</button>
    <a class="btn btn-default" href="#" title='About "Listed By"' data-content="You can opt out from receiving messages from certain people." data-toggle="popover"><i class="fa fa-question-circle"></i></a>
  </div>
</form>

{% else %}
  <p>You are not in anyone's contact list.</p>
{% endif %}
{% endblock %}
