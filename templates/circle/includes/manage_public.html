{% load bootstrap %}

<script type="text/javascript">
  $(document).ready(function() {
    // initialize check, do once only when document is loaded.
    var initial_value =  $('input#id_circle').val();
    initial_value.split(',').forEach(function(i) {
      $('input[value="' + i + '"]').prop('checked', true);
    });

    // whenever something is clicked.
    $('input[name="circle"]').change(function(){
      // get all checked value
      var checked = $('input[name="circle"]:checked').map(function(_, el) {
        return $(el).val();
      }).get();

      // set the value
      $('input#id_circle').val(checked.join());
    });
  });
</script>

<div>
  {% for group in form.circle_options %}
    <div class="panel panel-default">
      <div class="panel-heading">
        <small class="text-small text-muted" title="{{ group.description }}" data-toggle="tooltip">{{ group.title }}</small>
      </div>
      <ul class="list-group">
        {% for circle in group.list %}
          <li class="list-group-item">
            <input type="checkbox" class="switch" name="circle" value="{{ circle.id }}"{% if circle.active %} checked{% endif %}>
            {{ circle.title }} <small class="text-muted">{{ circle.description }}</small>
{#            {% if circle.active %} <span class="badge">{{ circle.approved|yesno:'Approved,Not approved' }}</span>{% endif %}#}
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endfor %}
</div>

<form class="form" method="post" autocapitalize="off">
  {% csrf_token %}
  {{ form|bootstrap }}
  {% block submit-block %}
  <div class="form-group">
    <button class="btn btn-primary" type="submit">Update</button>
    <span class="help-block">Changes are not saved unless you press the "Update" button. People in the circles will be notified to approve or disapprove your application to join the circles.</span>
  </div>
  {% endblock %}
</form>