{% extends "circle/base.html" %}
{% load bootstrap %}

{% block title %}Join Groups{% endblock %}
{% block help-message %}Join groups to meet new parents.{% endblock %}

{% block more_header %}
<link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/css/select2.min.css" rel="stylesheet" />
<script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/select2.min.js"></script>

<script type="text/javascript">
  $(document).ready(function() {
    var $select = $("select[name='tags']");

    function decorateSelection (state) {
      if (!state.id) { return state.text; }
      var $state = $(
          '<span class="circle-tag hover-pointer" data-id="' + state.id + '">' + state.text + '</span>'
      );
      return $state;
    }

    $select.select2({
      // tags: true,
      // tokenSeparators: [',']
      templateSelection: decorateSelection,
    });

    // monitor changes
    $select.on('change', function(e) {
      $('.changes-notice').removeClass('hidden');
    });

    // click to go to group page
    $('form').on('click', 'span.circle-tag', function(e) {
      var id = $(this).data('id');
      if (id) {
        window.location = '/connect/group/' + id + '/';
      }
    });
  });
</script>
{% endblock %}

{% block manage-block %}
  <a href="" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#create-modal-form"><i class="fa fa-plus-square"></i> Add new group</a>
  <form class="form" method="post">
    {% csrf_token %}
    {{ form|bootstrap }}
    <p class="text-danger hidden changes-notice"><i class="fa fa-exclamation"></i> Changes are not saved.</p>
    <div class="form-group">
      <button class="btn btn-primary" type="submit">Save Changes</button>
    </div>
  </form>

  {# create modal form #}
  <div class="modal fade" id="create-modal-form"><div class="modal-dialog"><div class="modal-content">
    <form class="form-horizontal" method="post" action="{% url 'circle:tag_add' %}">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Add New Group</h4>
      </div>
      <div class="modal-body">
        {% csrf_token %}
        {{ create_form|bootstrap_horizontal }}
      </div>
      <div class="modal-footer">
        <input type="submit" value="Add" class="btn btn-primary" id="modal-form-submit">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </form>
  </div></div></div>
{% endblock %}
