<script>
  $(document).ready(function() {
    function centerCalendarViewRender(view, element) {
      //$.get('{% url "log:comment_location" cid=center.id %}', function(data) {
      //  console.log(data);
      //});
      calendarChangeBookmark(view);
      var wall = $('#center-wall').data('wall');
      if (wall) {
        wall.centerWallView.render();
      }

      var calendar_day = view.calendar.getDate();
      $('#panel-container-panel-center-wall .panel-title a').text('Wall (' + calendar_day.format('MMM. D') + ')');

      // only show comment icon on agendaWeek view.
      //if (view.type == 'agendaWeek') {
      //$('.fc-day-header', $calendar_filled).append(' <i class="fa fa-comment-o"></i>');
      //}
    }

    var calendarDefaults = getCalendarDefaults();
    $.extend(calendarDefaults, {
      defaultView: getParameterByName('view') || 'agendaDay',
      viewRender: centerCalendarViewRender,
      loading: function(isLoading, view) {
        if (isLoading) {
          $('#fullcalendar-loading').show();
        } else {
          $('#fullcalendar-loading').hide();
        }
      }
    });

    var $calendar_filled = $('#calendar-filled');
    var $calendar_empty = $('#calendar-empty');
    var $calendar_available = $('#calendar-available');

    $calendar_filled.fullCalendar($.extend(calendarDefaults, {
      events: '{% url "cal:center_events_filled" cid=center.id %}'
    }));

    $calendar_empty.fullCalendar($.extend(calendarDefaults, {
      events: '{% url "cal:center_events_empty" cid=center.id %}'
    }));

    $calendar_available.fullCalendar($.extend(calendarDefaults, {
      events: '{% url "cal:center_events_available" cid=center.id %}'
    }));

    $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
      $calendar_filled.fullCalendar('render');
      $calendar_empty.fullCalendar('render');
      $calendar_available.fullCalendar('render');
    });

    // post message on the wall
    $('#panel-center-wall :submit').click(function(jsEvent) {
      jsEvent.preventDefault();
      var day = getRequestDay();
      var message = $('#panel-center-wall input[name=comment]').val();
      if (message) {
        // send post request
        $.post('{% url "log:comment_location" cid=center.id %}', {day: day, message: message}, function(data, status, jqxhr) {
          $('#panel-center-wall input[name=comment]').val('');
          if (jqxhr.status == 201) {
            // successfully created.
            var wall = $('#center-wall').data('wall');
            if (wall) {
              wall.centerWallView.render();
            }
          }
        });
      } // end of if (message)
    });

  }); // end of document.ready().
</script>