{% extends 'base.html' %}
{% load account_tags %}
{% load p2_tags %}

{% block page %}
<div class="row" data-uid="{{ target_user.id }}">
  <aside class="col-sm-4">
    <div class="panel panel-default">
      <div class="panel-body text-center">
        <div class="thumbnail">{% if full_access %}<a href="{% url 'account_picture' %}" id="link_account_picture">{% endif %}<img src="{% user_picture_url target_user %}" alt="user picture" class="img-rounded img-responsive">{% if full_access %}</a>{% endif %}</div>
        <h4 class="text-center">{% user-full-name target_user %} {% if full_access %}<small><a href="{% url 'account_edit' %}" id="link_account_edit"><i class="fa fa-edit"></i></a></small>{% endif %}</h4>
      </div>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading panel-title">Contact</div>
      <ul class="list-group">
        <li class="list-group-item"><i class="fa fa-envelope"></i> <a href="mailto:{{ target_user.email }}">{{ target_user.email }}</a></li>
        {% if target_user.info.phone %}
          <li class="list-group-item"><i class="fa fa-phone"></i> <a href="tel:{{ target_user.info.phone }}">{{ target_user.info.phone }}</a></li>
        {% endif %}
        {% if target_user.info.address %}
          <li class="list-group-item"><i class="fa fa-truck"></i> <a href="https://www.google.com/maps/place/{{ target_user.info.address|urlencode }}">{{ target_user.info.address }}</a></li>
        {% endif %}
      </ul>
    </div>
    {% if target_user.info.note %}
      <div class="panel panel-default">
        <div class="panel-heading panel-title">About</div>
        <div class="panel-body">{{ target_user.info.note|default:"Nothing." }}</div>
      </div>
    {% endif %}
    <div class="panel panel-{% if favors_karma %}warning{% else %}default{% endif %}">
      <div class="panel-heading panel-title">Favors Karma <i class="fa fa-question-circle" data-toggle="tooltip" title="Help other parents babysit and have them return the favor when you need help. Paid babysitting is not a favor. Favors will show here 1-2 days after successfully delivered."></i></div>
      <div class="panel-body">
        {% if favors_karma %}
          {% for favor_user, count in favors_karma %}
          {% with other=favor_user me=target_user %}{% if count > 0 %}
            <span class="label label-success match-favors-label" data-toggle="tooltip" title="{% user-short-name other %} owes you ({% user-short-name me %}) {{ count }} favor{{ count|pluralize }}"><i class="fa fa-balance-scale"></i> {{ count }} {% user-short-name other %}</span>
          {% elif count < 0 %}
            <span class="label label-danger match-favors-label" data-toggle="tooltip" title="You ({% user-short-name me %}) owe {% user-short-name other %} {{ count|negate }} favor{{ count|negate|pluralize }}"><i class="fa fa-balance-scale"></i> {{ count|negate }} {% user-short-name other %}</span>
          {% endif %}{% endwith %}
          {% endfor %}
        {% else %}
          No favors owed.
        {% endif %}
      </div>
    </div>
  </aside>

  <div class="col-sm-8">

  <div class="panel panel-primary">
    <div class="panel-heading panel-title">{% user-short-name target_user %}'s List {% if full_access %}<small><a href="{% url 'circle:manage_personal' %}" id="link_manage_personal"><i class="fa fa-edit"></i></a></small>{% endif %}</div>
    <div class="panel-body">
      {% if my_listed %}
      <div class="row">
        {% for u in my_listed %}
          <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
            {% include 'account/view/horizontal.html' with user=u %}
          </div>
        {% endfor %}
      </div>
      {% else %}
        <p class="">None.</p>
  {#      <p class="">None. <a href="{% url 'circle:manage_personal' %}">Click here</a> to manage your personal circle.</p>#}
      {% endif %}
    </div>
  </div>

  <div class="panel panel-primary">
    <div class="panel-heading panel-title">{% user-short-name target_user %}'s Circles {% if full_access %}<small><a href="{% url 'circle:manage_public' %}" id="link_manage_public"><i class="fa fa-edit"></i></a></small>{% endif %}</div>
    <div class="panel-body">
    {% if my_memberships %}
      <div class="row">
      {% for m in my_memberships %}
        <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
          <div class="panel panel-default">
            <div class="panel-body">
              <span title="{{ m.approved|yesno:'Approved,Not approved' }}. {{ m.circle.description }}" data-toggle="tooltip" class="{% if not m.approved %}text-muted{% endif %}">
                {{ m.circle.name }}<br>
                <small class="pull-right">{% include 'elements/circle_member_count.html' with count=m.circle.count %}</small>
              </span>
            </div>
          </div>
        </div>
      {% endfor %}
      </div>
    {% else %}
      <p class="">None.</p>
    {% endif %}
    </div>
  </div>

  <div class="panel panel-primary">
    <div class="panel-heading panel-title">Listed By {% if full_access%}<small><a href="{% url 'circle:manage_loop' %}" id="link_manage_loop"><i class="fa fa-edit"></i></a></small>{% endif %}</div>
    <div class="panel-body">
      {% if in_others %}
      <div class="row">
        {% for u in in_others %}
          <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
            {% include 'account/view/horizontal.html' with user=u %}
          </div>
        {% endfor %}
      </div>
      {% else %}
        <p class="">None.</p>
  {#      <p class="">None. <a href="{% url 'circle:manage_personal' %}">Click here</a> to manage your personal circle.</p>#}
      {% endif %}
    </div>
  </div>

  </div>
</div>
{% endblock %}
